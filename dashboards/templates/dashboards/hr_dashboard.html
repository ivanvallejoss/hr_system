{% extends 'dashboards/base.html' %}

{% block content %}

<div class="row">
    <div class="col-12 mb-4">
        <h2>HR Management Dashboard</h2>
        <p class="text-muted">Welcome back, {{hr_user.get_full_name|default:hr_user.username }} | Manage your workforce efficiently</p>
    </div>
</div>

<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-building"></i>Company Overview</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-12 mb-3">
                        <h2 class="text-primary">{{ total_employee }}</h2>
                        <small class="text-muted">Active Employees</small>
                    </div>
                </div>
                <hr>
                <div class="row text-center">
                    <div class="col-4">
                        <h5 class="text-info">{{ seniority_breakdown.JUNIOR }}</h5>
                        <small>Junior</small>
                    </div>
                    <div class="col-4">
                        <h5 class="text-warning">{{ seniority_breakdown.MID }}</h5>
                        <small>Mid</small>
                    </div>
                    <div class="col-4">
                        <h5 class="text-success">{{ seniority_breakdown.SENIOR }}</h5>
                        <small>Senior</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity Card -->
     <div class="col-md-8 mb-4">
        <div class="card w-100">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-clock"></i>Recent Activity (Last 30 days)</h5>
            </div>
            <div class="card-body">
                {% if recent_hires_count > 0 %}
                    <p class="mb-3"><strong>{{ recent_hires_count }} new hire{{ recent_hires_count|pluralize }}</strong> in the last 30 days</p>
                    <div class="row">
                        {% for hire in recent_hires %}
                            <div class="col-md-6 mb-2">
                                <div class="card border-light">
                                    <div class="card-body py-2">
                                        <h6 class="card-title mb-1">{{ hire.full_name }}</h6>
                                        <small class="text-muted">{{ hire.role_id.title }} - {{ hire.role_id.department_id.name }}</small>
                                        <small class="text-success">Hired: {{ hire.hire_date|date:"M d, Y" }}</small>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-3">
                        <i class="fas fa-user-plus fa-2x text-muted mb-2"></i>
                        <p class="text-muted mb-0">No new hires in the last 30 days</p>
                    </div>
                {% endif %}
            </div>
        </div>
     </div>
</div>

<!-- HR actions Row -->

<div class="row">
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-tools"></i> HR Management Tools</h5>
            </div>
            <div class="car-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-primary w-100" disabled>
                            <i class="fas fa-user-plus"></i> Add Employee
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-success w-100" disabled>
                            <i class="fas fa-building"></i> Manage Departments
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-warning w-100" disabled>
                            <i class="fas fa-chart-bar"></i> Generate Reports
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-danger w-100" disabled>
                            <i class="fas fa-cog"></i> HR Settings
                        </button>
                    </div>
                </div>
                <small class="text-muted"> <em>HR management tools will be implemented in future phases.</em></small>
            </div>
        </div>
    </div>
</div>

<!-- Department Stats Row -->

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0"><i class="fas fa-sitemap"></i> Department Overview</h5>
            </div>
            <div class="card-body">
                {% if department_stats  %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Department</th>
                                    <th>Manager</th>
                                    <th>Employees</th>
                                    <th>Budget</th>
                                    <th>Avg. Cost per Employee</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for dept in department_stats %}
                                    <tr>
                                        <td><strong>{{ dept.name }}</strong></td>
                                        <td>
                                            {% if dept.department_manager__user__first_name %}
                                                {{ dept.deparment_manager__user__first_name }} {{ dept.department_manager__user__last_name }}
                                            {% else %}
                                                <em class="text-muted">No manager assigned</em>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <span class="badge bg-primary">{{ dept.employee_count }}</span>
                                        </td>
                                        <td>
                                            {% if dept.total_budget %}
                                                ${{ dept.total_budget|floatformat:0 }}
                                            {% else %}
                                                <em class="text-muted">Not set</em>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if dept.total_budget and dept.employee_count > 0 %}
                                                ${{ dept.total_budget|floatformat:0 }}
                                            {% else %}
                                                <em class="text-muted">N/A</em>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-building fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No Departments Found</h5>
                        <p class="text-muted">Create departments to see statistics here.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}